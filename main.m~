%% Setup Stuff

clear;
close all;
clc;

% Add IPOPT and other potential packages
setup_paths

%% Define an arbitrary path

ts = 0.01;

t = 0:0.01:2;
u_expected = [sin(t*pi); cos(t*pi)];
q0_expected = [0;0;0];
q_expected = zeros(3, numel(t));
q_expected(:,1) = q0_expected;

for index = 1:(numel(t)-1)
    q_expected(:, index+1) = unicycle_dynamics(q_expected(:, index), u_expected(:, index), ts);
end

plot(q_expected(1,:), q_expected(2,:))


%% Do MPC

% Time horizon
N = 10;

q0 = [0; -0.2; 0];

q = zeros(3, numel(t));
q(:,1) = q0;

u = zeros(2, numel(t));

figure()
hold on;

for index = 1:(numel(t)-1)
    [q_opt, u_opt] = unicycle_MPC(N, q0, q_expected(index:, u_expected, ts);
    
    
    
end


















